<app-admin-navbar></app-admin-navbar>

<mat-tab-group>
  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon class="example-tab-icon">library_books</mat-icon>
      All Tickets
    </ng-template>

    <head>
      <script
        src="https://kit.fontawesome.com/a076d05399.js"
        crossorigin="anonymous"
      ></script>
    </head>
    <form class="example" [formGroup]="searchForm">
      <nav
        class="navbar"
        style="width: 1265px; margin-left: 320px; margin-top: 10px"
      >
        <div class="container-fluid">
          <form class="d-flex" role="search">
            <input
              class="form-control me-2"
              #search
              placeholder="Search..."
              name="search"
            />
            <button
              class="btn btn-outline-success"
              type="submit"
              style="width: max-content"
            >
              Search
            </button>
          </form>
        </div>
      </nav>
    </form>

    <div
      *ngIf="tickets.length > 0; else noTickets"
      class="container"
      style="width: 2500px"
    >
      <div
        class="content"
        style="font-size: 25px; font-weight: 200; font-family: monospace"
      >
        <table class="table table-hover">
          <thead class="text-black" style="text-align: left">
            <tr>
              <th scope="col">Ticket ID</th>
              <th scope="col">User ID</th>
              <th scope="col">Subject</th>
              <th scope="col">Description</th>
              <th scope="col">Date Created</th>
              <th scope="col">Actions</th>
              <th scope="col">Status</th>
            </tr>
          </thead>
          <tbody
            style="text-align: left"
            *ngFor="let ticket of tickets; let i = index"
          >
            <tr>
              <th scope="row">{{ ticket.ticketID }}</th>
              <th scope="row">{{ ticket.userID }}</th>

              <td>{{ ticket.subject }}</td>
              <td>{{ ticket.description }}</td>
              <th scope="row">{{ ticket.created_at }}</th>
              <td>
                <button
                  type="button"
                  class="btn btn-primary btn-sm"
                  (click)="updateTicket(ticket)"
                >
                  View Request
                </button>
              </td>
              <td>
                <span
                  style="width: 100px"
                  *ngIf="
                    (ticket.status == 'Pending' ||
                      ticket.status == 'Checked' ||
                      ticket.status == 'Accepted' ||
                      ticket.status == 'Waiting for Client' ||
                      ticket.status == 'Waiting for Confirmation') &&
                    !checkForAgingTicket(ticket)
                  "
                  class="badge text-bg-success"
                  >New</span
                >
                <span
                  style="width: 100px"
                  *ngIf="
                    ticket.status == 'Pending' && checkForAgingTicket(ticket)
                  "
                  class="badge text-bg-warning"
                  >Warning</span
                >
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </mat-tab>

  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon class="example-tab-icon">supervised_user_circle</mat-icon>
      Client Accounts
    </ng-template>
    <!--TAB 1-->
    <mat-form-field>
      <mat-label>Filter</mat-label>
      <input
        matInput
        (keyup)="applyFilter($event)"
        placeholder="Ex. ium"
        #input
      />
    </mat-form-field>
    <section class="example-container mat-elevation-z8" tabindex="0">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
        <!-- Position Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>ID</th>
          <td mat-cell *matCellDef="let user">{{ user.userID }}</td>
        </ng-container>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Name</th>
          <td mat-cell *matCellDef="let user">{{ user.user_fname }}</td>
        </ng-container>

        <!-- Weight Column -->
        <ng-container matColumnDef="username">
          <th mat-header-cell *matHeaderCellDef>Username</th>
          <td mat-cell *matCellDef="let user">{{ user.user_username }}</td>
        </ng-container>

        <!-- Symbol Column -->
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef>Email</th>
          <td mat-cell *matCellDef="let user">{{ user.user_email }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">
            No data matching the filter "{{ input.value }}"
          </td>
        </tr>
      </table>
    </section>
    <!--END TAB 1-->
  </mat-tab>

  <mat-tab>
    <ng-template mat-tab-label>
      <mat-icon class="example-tab-icon">account_circle</mat-icon>
      Employee Accounts
    </ng-template>
    <!--TAB 2-->

    <!--END TAB 2-->
  </mat-tab>
</mat-tab-group>

<ng-template #noTickets>
  <hr />
  <h5 class="noTickets">There are no tickets listed!</h5>
</ng-template>
